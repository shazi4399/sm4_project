//
// Created by zhanghao on 22-7-25.
//https://blog.csdn.net/weixin_42282031/article/details/108627678
//mm.c
#include <stdio.h>
#include "sm4.h"

static uint8_t txt[] = {
        0xf5, 0xa0, 0x3b, 0x06, 0x48, 0xd2, 0xc4 ,0x63, 0x0e, 0xea, 0xc5, 0x13, 0xe1, 0xbb, 0x81, 0xa1,
        0x59, 0x44, 0xda, 0x38, 0x27, 0xd5, 0xb7, 0x41, 0x43, 0xac, 0x7e, 0xac, 0xee, 0xe7, 0x20, 0xb3,
        0xb1, 0xb6, 0xaa, 0x29, 0xdf, 0x21, 0x2f, 0xd8, 0x76, 0x31, 0x82, 0xbc, 0x0d, 0x42, 0x1c, 0xa1,
        0xbb, 0x90, 0x38, 0xfd, 0x1f, 0x7f, 0x42, 0xd4, 0x84, 0x0b, 0x69, 0xc4, 0x85, 0xbb, 0xc1, 0xaa,
        0x11, 0x22, 0x51, 0x56, 0x67, 0x89, 0x98, 0x43, 0x23, 0x67, 0x89, 0x98, 0x43, 0x23, 0x67, 0x89,
        0x98, 0x43, 0x23, 0x98, 0x43, 0x23, 0x98, 0x43, 0x23, 0x98, 0x43, 0x23, 0x98, 0x43, 0x23, 0x98,
        0x43, 0x23
};



int32_t main(void)
{
    uint8_t key[16] = {0};
    uint8_t iv[16] = {0};
    uint8_t cipher[130] = {0};
    uint8_t buf[128] = {0};
    uint32_t len;
    sm4_data_t data;

    if (sm4_data_init(&data, SM4_MODE_CTR)) {
        return -1;
    }

    sm4_gen_key(&data, key, sizeof(key));
    sm4_gen_iv(&data, iv, sizeof(iv));
    show_hex("key", key, sizeof(key));
    show_hex("iv", iv, sizeof(iv));

    show_hex("data", txt, sizeof(txt));
    sm4_encrypt_data(&data, txt, sizeof(txt), cipher, &len);

    show_hex("cipher", cipher, len);

    sm4_decrypt_data(&data, cipher, len, buf, &len);
    show_hex("buf", buf, len);

    sm4_data_exit(&data);
    return 0;
}
